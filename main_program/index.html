<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Shiran Main Program - Conway Home</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <canvas id="lifeCanvas" aria-label="生命游戏画布"></canvas>

    <header class="top-shell">
      <section id="brandPanel" class="brand-panel autohide-card" aria-label="首页标题">
        <p class="brand-kicker">Shiran Main Program</p>
        <p class="brand-slogan">世然 Shiran · 好奇心的交互实验场</p>
        <h1>生命游戏导航系统</h1>
        <p class="brand-tip">理解世界的底层原理，从一个活细胞开始。</p>
        <p class="brand-tip brand-tip-mini">点击活细胞进入模块，滚轮缩放/拖拽平移，单格放大到超过屏幕后自动下潜。</p>
      </section>

      <div id="topControls" class="top-controls autohide-card" role="toolbar" aria-label="首页控件">
        <label class="speed-control" for="speedInput">
          <span class="speed-label">演化节奏</span>
          <input
            id="speedInput"
            type="range"
            min="120"
            max="5000"
            step="20"
            value="900"
            aria-label="演化速度（毫秒）"
          />
          <span id="speedValue" class="speed-value">900ms</span>
        </label>
        <label class="zoom-control" for="zoomInput">
          <span class="speed-label">画布缩放</span>
          <input
            id="zoomInput"
            type="range"
            min="100"
            max="52000"
            step="20"
            value="100"
            aria-label="画布缩放百分比"
          />
          <span id="zoomValue" class="speed-value">100%</span>
        </label>
        <button id="btnResetView" type="button">视图复位</button>
        <button id="btnLegend" type="button">图例</button>
        <button id="btnFullscreen" class="icon-btn" type="button" aria-label="进入全屏" title="进入全屏">⛶</button>
        <button id="btnOverview" class="icon-btn" type="button" aria-label="打开全览" title="打开全览">▦</button>
        <button id="btnSettings" class="icon-btn" type="button" aria-label="打开设置" title="打开设置">⚙</button>
      </div>
    </header>

    <section id="legendPanel" class="floating-panel" aria-label="场景图例">
      <h3>场景图例</h3>
      <div class="legend-content"></div>
      <div class="legend-divider"></div>
      <h4 class="legend-subtitle">RSS 源颜色图例</h4>
      <div id="rssColorLegend" class="rss-color-legend">
        <div class="overview-empty">暂无 RSS 源</div>
      </div>
      <label class="toggle-row">
        <input id="highContrastToggle" type="checkbox" />
        <span>高对比模式（色弱友好）</span>
      </label>
    </section>

    <div id="overviewBackdrop" class="overview-backdrop" aria-hidden="true"></div>

    <aside id="overviewDrawer" class="overview-drawer" aria-label="探索单元全览">
      <div class="drawer-header">
        <h3>探索单元全览</h3>
        <button id="overviewClose" type="button" aria-label="关闭全览">关闭</button>
      </div>
      <div class="drawer-tabs" role="tablist" aria-label="全览模式">
        <button id="tabCore" class="drawer-tab is-active" type="button" role="tab" aria-selected="true">核心模块库</button>
        <button id="tabDaily" class="drawer-tab" type="button" role="tab" aria-selected="false">每日新知流</button>
        <button id="tabMixed" class="drawer-tab" type="button" role="tab" aria-selected="false">混合</button>
        <button id="tabSaved" class="drawer-tab" type="button" role="tab" aria-selected="false">收藏池</button>
      </div>
      <div class="drawer-search">
        <input id="overviewSearch" type="search" placeholder="搜索标题 / 场景 / 机制" />
      </div>
      <div id="overviewMeta" class="drawer-meta"></div>
      <div id="savedQuickAdd" class="saved-quick-add is-hidden" aria-label="收藏池手动添加">
        <input id="savedManualTitle" type="text" maxlength="80" placeholder="手动标题（可选）" />
        <input id="savedManualUrl" type="url" placeholder="手动添加网址（https://...）" />
        <button id="savedManualAddBtn" type="button">加入收藏池</button>
        <div class="saved-batch-ops" aria-label="收藏池批量操作">
          <button id="savedBatchToggleBtn" type="button">批量选择</button>
          <button id="savedSelectAllBtn" type="button">全选当前列表</button>
          <button id="savedClearSelectionBtn" type="button">清空选择</button>
          <button id="savedDeleteSelectedBtn" type="button">删除已选 (0)</button>
        </div>
      </div>
      <div id="overviewList" class="overview-list"></div>
    </aside>

    <aside id="settingsDrawer" class="settings-drawer" aria-label="站点设置">
      <div class="drawer-header">
        <h3>设置</h3>
        <button id="settingsClose" type="button" aria-label="关闭设置">关闭</button>
      </div>

      <section class="settings-section" aria-label="点击行为">
        <h4>外部链接打开方式（仅新知流）</h4>
        <label class="radio-row">
          <input id="openModePreview" name="openMode" type="radio" value="preview" checked />
          <span>弹窗预览（推荐）</span>
        </label>
        <label class="radio-row">
          <input id="openModeDirect" name="openMode" type="radio" value="direct" />
          <span>直接跳转网页</span>
        </label>
      </section>

      <section class="settings-section" aria-label="RSS源配置">
        <div class="settings-heading">
          <h4>每日新知流 RSS 源</h4>
          <div class="settings-actions-inline">
            <button id="rssOpmlBtn" type="button" class="mini-btn">导入 OPML</button>
            <button id="rssReloadBtn" type="button" class="mini-btn">刷新</button>
          </div>
        </div>
        <p class="section-tip">配置后用于“每日新知流”与“混合”模式，支持多源并行。部分站点需后端代理才可稳定抓取。</p>
        <input id="rssOpmlInput" type="file" accept=".opml,.xml,text/xml,application/xml" hidden />
        <div class="rss-add-grid">
          <input id="rssNameInput" type="text" maxlength="28" placeholder="源名称（如 少数派）" />
          <input id="rssUrlInput" type="url" placeholder="RSS URL（https://...）" />
          <button id="rssAddBtn" type="button">添加源</button>
        </div>
        <div id="rssSourceList" class="rss-source-list"></div>
        <p class="section-tip">RSS 源颜色图例</p>
        <div id="rssColorLegendInline" class="rss-color-legend rss-color-legend-inline">
          <div class="overview-empty">暂无 RSS 源</div>
        </div>
        <button id="rssResetBtn" type="button" class="ghost-btn">恢复默认源</button>
      </section>

      <section class="settings-section" aria-label="开放API">
        <h4>开放 API（V1）</h4>
        <p class="section-tip">第三方模块接入可遵循统一契约，后续可升级到投稿审核流。</p>
        <pre class="api-snippet">GET  /api/v1/units
GET  /api/v1/units/{id_or_slug}
GET  /api/v1/taxonomy
POST /api/v1/events/batch</pre>
      </section>

      <section class="settings-section" aria-label="打赏支持">
        <h4>支持世然</h4>
        <p class="section-tip">如果这个站点对你有帮助，你可以赞助它持续迭代。</p>
        <a id="donateLink" class="donate-link" href="https://afdian.com/a/laimiu" target="_blank" rel="noopener noreferrer">
          请我喝杯咖啡
        </a>
      </section>
    </aside>

    <section id="unitPreview" class="unit-preview autohide-card" aria-live="polite">
      <h3 id="unitPreviewTitle">模块占位符</h3>
      <div id="unitPreviewBody">
        <p>点击活细胞后，这里展示模块信息。</p>
      </div>
    </section>

    <div id="statusText" class="status-text autohide-card">初始化中...</div>

    <div id="contentModal" class="content-modal" aria-hidden="true">
      <div id="contentModalBackdrop" class="content-modal-backdrop"></div>
      <section id="contentModalPanel" class="content-modal-panel" role="dialog" aria-label="原文弹窗">
        <div class="content-modal-header">
          <h3 id="contentModalTitle">原文</h3>
          <div class="content-modal-actions">
            <div class="content-modal-zoom-controls" role="group" aria-label="弹窗缩放">
              <button id="contentModalZoomOut" type="button" aria-label="缩小弹窗">-</button>
              <button id="contentModalZoomReset" type="button" aria-label="重置弹窗缩放">100%</button>
              <button id="contentModalZoomIn" type="button" aria-label="放大弹窗">+</button>
            </div>
            <button id="contentModalSave" type="button" aria-label="收藏当前细胞">收藏细胞</button>
            <button id="contentModalClose" type="button" aria-label="关闭原文弹窗">关闭</button>
          </div>
        </div>
        <div id="contentModalBody" class="content-modal-body">
          <p>加载中...</p>
        </div>
      </section>
    </div>

    <div id="hintLayer" class="hint-layer hidden" role="dialog" aria-label="首次引导">
      <div class="hint-card">
        <h2>轻引导</h2>
        <p>点击任意活细胞，即可进入对应探索模块。</p>
        <p>滚轮可缩放，按住拖拽可查看局部细节。</p>
        <p>当单个像素放大到超过屏幕后，会平滑进入下一层画布。</p>
        <p>任意画布继续缩小到最小以下，会平滑上浮到另一画布。</p>
        <p>后续不再展示，你可以自由探索。</p>
        <button id="hintDismiss" type="button">开始探索</button>
      </div>
    </div>

    <div id="toast" class="toast" aria-live="polite"></div>

    <script type="module" src="./src/app.js"></script>
  </body>
</html>
